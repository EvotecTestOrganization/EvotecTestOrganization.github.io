# Project Server 2013 add tasks to multiple projects from CSV Fil

## Original Links

- [x] Original Technet URL [Project Server 2013 add tasks to multiple projects from CSV Fil](https://gallery.technet.microsoft.com/server-2013-add-tasks-to-72c2697a)
- [x] Original Technet Description URL [Description](https://gallery.technet.microsoft.com/server-2013-add-tasks-to-72c2697a/description)
- [x] Download: [Download Link](Download\Project Server 2013-AddNamedTaskstoProjectFromCSV.ps1)

## Output from Technet Gallery

This borrows from Jim E. Cox's work. You will need to create an MSDOS CSV File for this (Not a comma delimited file)

 As is this is designed for only 2 columns Column 1 is the project GUID and Column 2 is the task name. (you must have the GUID of the project like this:

Proejct 1: Task 1

Project 1: task 2

Project 2: taks 1

Project 2: task 2

Etc

 You can add more columns, such as date, if you want other fields. Also note the date field in the tasks.

 This will create one summary task per project then all subsequent tasks are listed under that.

 Also this postions the tasks at the end of the project.

 I started out in my testing with some sleep commands but as you see they are commented out because I ended up not needing them in my environment.

 I added about 3,000 total tasks into 600 different projects in about an hour.

```
cls
<# This borrows from Jim E. Cox's work. You will need to create an MSDOS CSV File for this (Not a comma delimited file)
As is this is designed for only 2 columns Column 1 is the project GUID and Column 2 is the task name. (you must have hte GUID of the project
You can add more columns if you want other fields. Also note the date field in the tasks.
This will create one summary task per project then all subsequent tasks are listed under that.
Also this postions the tasks at the end of the project.
I started out in my testing with some sleep commands but as you see they are commented out because I ended up not needing them in my environment.
I added about 3,000 total tasks into 600 different projects in about an hour.
#>
#Lets open the CSV (CSV is faser than Excel)
$TaskList = Import-CSV "C:\test.csv"
$PriorProjGUID = ""
FOREACH ($Task in $TaskList)
{
    # Get the project GUID from the file. "ProjectGUID" is the header name of the column in the CSV File
    # And we will grab the task name as well since we are here
    $ProjGUID = $Task.ProjectGUID
    $TaskName = $Task.TaskName
    # Lets do this while the project is the same
    If ($ProjGUID -ne $PriorProjGUID)
    {
     #let's save, publish and checkin the project if there is a new one in the list
      If ($PriorProjGUID -ne "")
        {
            # Add the above dataset to project and publish and check in
            $ProjSvcProxy.QueueAddToProject($NewJobGuid, $SessionGUID, $ProjDataSet, $false);
            $ProjSvcProxy.QueuePublish($NewJobGuid, $PriorProjGuid, "true","")
         ## Start-sleep 20
            $ProjSvcProxy.QueueCheckInProject($NewJobGuid, $PriorProjGuid, $false, $SessionGuid, $SessionDescr);
         }
      #Let's set the project name to the prior projct name so we can track our loop
       $PriorProjGUID = $ProjGUID
      # we will open the project in this seciton first we have to set session variables and the like
        # Set our variables
        $SessionGuid = [System.Guid]::NewGuid()
        $SessionDescr = "Add tasks session"
        #$NewJobGuid = [System.Guid]::NewGuid()
        $EPMTYGUID = [system.guid]::empty
        $PWAUrl = “http://msps.itcs.URL.com/pwa”
        # initiate the PSI Web Services
        #Project Web Service
        $ProjSvcURL = $PWAUrl + "/_vti_bin/PSI/Project.asmx?wsdl"
        $ProjSvcProxy = New-WebServiceProxy -uri $ProjSvcURL -useDefaultCredential #-credential $Credential
        $QSvcUrl = $pwaUrl + "/_vti_bin/PSI/QueueSystem.asmx?wsdl"
        $QSvcProxy = New-WebServiceProxy -uri $QSvcUrl -useDefaultCredential #-credential $Credential
        # Now let's check the project out
         $ProjSvcProxy.CheckOutProject("$ProjGuid", $sessionGuid, $SessionDescr);
        #give it a chance to check out
        ##Start-sleep 30
        # Add tasks.
         $ProjDataset = New-Object Microsoft.PowerShell.Commands.NewWebserviceProxy.AutogeneratedTypes.WebServiceProxy1_vti_bin_PSI_Project_asmx_wsdl.ProjectDataSet
           #create a summary task
             $NewTaskGuid = [System.Guid]::NewGuid()
             $NewTaskRow1 = $ProjDataSet.Task.NewTaskRow();
             $NewTaskRow1.PROJ_UID = $ProjGuid;
             $NewTaskRow1.TASK_UID = $NewTaskGuid;
             $NewTaskRow1.Task_IS_SUMMARY = 1;
             $NewTaskRow1.Task_OUTLINE_LEVEL = 1;
             $NewTaskRow1.TASK_DUR_FMT = 53;
             $NewTaskRow1.TASK_NAME = "EPR-ID: Asset Tasks";
             $NewTaskRow1.Task_DUR_IS_EST = 1;
           $ProjDataSet.Task.AddTaskRow($NewTaskRow1);
      }
     $NewTaskGuid = [System.Guid]::NewGuid()
     $NewTaskRow1 = $ProjDataSet.Task.NewTaskRow();
     $NewTaskRow1.PROJ_UID = $ProjGuid;
     $NewTaskRow1.TASK_UID = $NewTaskGuid
     $NewTaskRow1.TASK_DUR_FMT = 53;
     $NewTaskRow1.TASK_DUR = 0;
     $NewTaskRow1.TASK_NAME = $TaskName;
     $NewTaskRow1.Task_OUTLINE_LEVEL = 2;
     $NewTaskRow1.TASK_START_DATE = '8/1/2015' #[datetime]::Now;
     $ProjDataSet.Task.AddTaskRow($NewTaskRow1);
 }
#Check in the last project
    # Add the above dataset to project and publish and check in
    $ProjSvcProxy.QueueAddToProject($NewJobGuid, $SessionGUID, $ProjDataSet, $false);
    $ProjSvcProxy.QueuePublish($NewJobGuid, $ProjGuid, "true","")
  #  Start-sleep 5
    $ProjSvcProxy.QueueCheckInProject($NewJobGuid, $ProjGuid, $false, $SessionGuid, $SessionDescr);
  Echo "We are all Done but the Queue has to finish that will take some time"
```

